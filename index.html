<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Peluquería Powell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;padding:20px}
select,input,button{width:100%;padding:10px;margin:8px 0}
button{background:black;color:white;border:none}
</style>
</head>
<body>

<h2>Reservar cita</h2>

<select id="service"></select>
<input type="date" id="date">
<select id="time"></select>
<button id="btn">Reservar</button>
<p id="msg"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA5CHMM2R2nIvYGgIi4RZVlE3zkjmJVew8",
  authDomain: "powell-barbershop.firebaseapp.com",
  projectId: "powell-barbershop",
  storageBucket: "powell-barbershop.firebasestorage.app",
  messagingSenderId: "508302099014",
  appId: "1:508302099014:web:8e773d69c8dc806442c047"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const serviceSel = document.getElementById("service");
const timeSel = document.getElementById("time");
const dateInp = document.getElementById("date");
const msg = document.getElementById("msg");
const btn = document.getElementById("btn");

let services = {};

async function loadServices(){
  const snap = await getDocs(collection(db,"config","services"));
  snap.forEach(d=>{
    services[d.id]=d.data();
    const o=document.createElement("option");
    o.value=d.id;
    o.textContent=d.id.replaceAll("_"," ")+" - "+d.data().price+"€";
    serviceSel.appendChild(o);
  });
}

function loadTimes(){
  timeSel.innerHTML="";
  const slots=["10:00","10:30","11:00","11:30","12:00","12:30","13:00",
               "16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30"];
  slots.forEach(t=>{
    const o=document.createElement("option");
    o.value=t;
    o.textContent=t;
    timeSel.appendChild(o);
  });
}

btn.onclick = async () => {
  if(!dateInp.value){
    msg.textContent="Elige fecha";
    return;
  }

  const service = services[serviceSel.value];
  if(!service){
    msg.textContent="Servicio no válido";
    return;
  }

  await addDoc(collection(db,"appointments"),
