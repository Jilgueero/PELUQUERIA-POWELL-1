<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Peluquer√≠a Powell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;padding:20px}
select,input,button{width:100%;padding:10px;margin:8px 0}
button{background:black;color:white;border:none}
</style>
</head>
<body>

<h2>Reservar cita</h2>

<select id="service"></select>
<input type="date" id="date">
<select id="time"></select>
<button onclick="reserve()">Reservar</button>
<p id="msg"></p>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA5CHMM2R2nIvYGgIi4RZVlE3zkjmJVew8",
  authDomain: "powell-barbershop.firebaseapp.com",
  projectId: "powell-barbershop",
  storageBucket: "powell-barbershop.firebasestorage.app",
  messagingSenderId: "508302099014",
  appId: "1:508302099014:web:8e773d69c8dc806442c047"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const serviceSel = document.getElementById("service");
const timeSel = document.getElementById("time");
const dateInp = document.getElementById("date");
const msg = document.getElementById("msg");

let services = {};

function toMin(t){const[a,b]=t.split(":");return (+a)*60+(+b);}

async function loadServices(){
  const snap = await getDocs(collection(db,"services"));
  snap.forEach(d=>{
    services[d.id]=d.data();
    const o=document.createElement("option");
    o.value=d.id;
    o.textContent=d.id.replaceAll("_"," ")+" - "+d.data().price+"‚Ç¨";
    serviceSel.appendChild(o);
  });
}

function loadTimes(){
  timeSel.innerHTML="";
  for(let h=10;h<21;h++){
    for(let m of [0,30]){
      const t=`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`;
      const o=document.createElement("option");
      o.value=t;o.textContent=t;
      timeSel.appendChild(o);
    }
  }
}

async function reserve(){
  if(!dateInp.value){msg.textContent="Elige fecha";return;}
  await addDoc(collection(db,"appointments"),{
    service:serviceSel.value,
    date:dateInp.value,
    time:timeSel.value,
    duration:services[serviceSel.value].duration,
    price:services[serviceSel.value].price,
    created:new Date()
  });
  msg.textContent="Cita reservada üëç";
}

loadServices();
loadTimes();
</script>

</body>
</html>
